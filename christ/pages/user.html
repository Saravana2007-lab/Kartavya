<h2>User Registration</h2>

<input id="name" placeholder="Full Name">
<input id="aadhaar" placeholder="Aadhaar Number">
<input id="phone" placeholder="Phone Number">

<div id="recaptcha"></div>

<button onclick="sendOTP()">Send OTP</button>

<input id="otp" placeholder="Enter OTP">
<button onclick="verifyOTP()">Verify OTP</button>

<hr>
<div id="dashboard" style="display:none;">
  <h3>Welcome! You are logged in ✅</h3>
</div>

<script type="module">
import { auth, db } from "../firebase.js";

import {
  RecaptchaVerifier,
  signInWithPhoneNumber
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

let confirmationResult;

// Create recaptcha
window.recaptchaVerifier = new RecaptchaVerifier(auth, "recaptcha", {});

// Send OTP
window.sendOTP = async function () {
  const phone = "+91" + document.getElementById("phone").value;

  confirmationResult = await signInWithPhoneNumber(
    auth,
    phone,
    recaptchaVerifier
  );

  alert("OTP Sent!");
};

// Verify OTP
window.verifyOTP = async function () {
  const otp = document.getElementById("otp").value;

  const result = await confirmationResult.confirm(otp);

  await setDoc(doc(db, "users", result.user.uid), {
    name: document.getElementById("name").value,
    aadhaar: document.getElementById("aadhaar").value,
    phone: document.getElementById("phone").value,
    createdAt: new Date()
  });

  alert("Login Successful ✅");

  document.getElementById("dashboard").style.display = "block";
};
</script>
